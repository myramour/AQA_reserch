pipeline {
    agent any
    stages {
        stage('Run tests') {
              agent {
                 dockerfile {
                    args '-u root --shm-size=1g'
                 }
              }
             steps{
                sh '''export M2_HOME=/opt/homebrew/Cellar/maven/3.8.6/libexec
                      export PATH=$PATH:$M2_HOME/bin
                      mvn clean test -Dconfig="${CONFIG}" -DsuiteXml=${SUITE}'''
            }
            post {
               always {
                   archiveArtifacts artifacts: 'target/logs/*', allowEmptyArchive: true
               }
            }
        }
    }
    post{
        always {
            allure includeProperties: false, jdk: '', results: [[path: 'target/allure-results']]
        }
    }
}